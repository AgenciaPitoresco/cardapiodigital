<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Card√°pio Digital</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#FF6B35',
                        secondary: '#F7931E',
                        tertiary: '#FFD23F',
                        dark: '#2D3748'
                    }
                }
            }
        }
    </script>
    <style>
        .sticky-header {
            position: sticky;
            top: 0;
            z-index: 50;
            background: white;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .category-scroll {
            scroll-behavior: smooth;
        }
        .product-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 100;
        }
        .modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .cart-badge {
            animation: pulse 0.5s ease-in-out;
        }
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Header Fixo -->
    <header class="sticky-header">
        <!-- Se√ß√£o 1: Logo, Nome, Slogan e Status -->
        <div class="bg-white px-4 py-3 border-b">
            <div class="max-w-6xl mx-auto flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <img id="logo" src="" alt="Logo" class="w-12 h-12 rounded-full object-cover">
                    <div>
                        <h1 id="nome-empresa" class="text-xl font-bold text-gray-800"></h1>
                        <p id="slogan" class="text-sm text-gray-600"></p>
                    </div>
                </div>
                <div class="flex items-center space-x-2">
                    <div id="status-loja" class="flex items-center space-x-2">
                        <div class="w-3 h-3 bg-green-500 rounded-full animate-pulse"></div>
                        <span class="text-sm font-medium text-green-600">Aberto</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Se√ß√£o 2: Menu de Categorias -->
        <div class="bg-white px-4 py-3 border-b">
            <div class="max-w-6xl mx-auto">
                <div id="categorias-menu" class="flex space-x-6 overflow-x-auto category-scroll">
                    <!-- Categorias ser√£o carregadas aqui -->
                </div>
            </div>
        </div>
    </header>

    <!-- Conte√∫do Principal -->
    <main class="max-w-6xl mx-auto px-4 py-6">
        <!-- Se√ß√£o de Busca e Filtros -->
        <div class="bg-white rounded-lg shadow-sm p-4 mb-6">
            <div class="flex flex-col md:flex-row gap-4 items-center">
                <!-- Busca -->
                <div class="flex-1 relative">
                    <input type="text" id="busca-produto" placeholder="Buscar produtos..." class="w-full pl-10 pr-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary">
                    <span class="absolute left-3 top-2.5 text-gray-400">üîç</span>
                </div>
                
                <!-- Filtros -->
                <div class="flex space-x-2">
                    <button id="filtro-todos" class="px-4 py-2 text-sm bg-primary text-white rounded-lg" onclick="aplicarFiltro('todos')">Todos</button>
                    <button id="filtro-vegano" class="px-4 py-2 text-sm bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300" onclick="aplicarFiltro('vegano')">üå± Vegano</button>
                    <button id="filtro-promocao" class="px-4 py-2 text-sm bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300" onclick="aplicarFiltro('promocao')">üî• Promo√ß√£o</button>
                    <button id="filtro-novidade" class="px-4 py-2 text-sm bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300" onclick="aplicarFiltro('novidade')">‚≠ê Novidades</button>
                </div>
                
                <!-- Compartilhar -->
                <button onclick="compartilharCardapio()" class="px-4 py-2 text-sm bg-green-600 text-white rounded-lg hover:bg-green-700">üì§ Compartilhar</button>
            </div>
        </div>

        <div id="produtos-container">
            <!-- Produtos ser√£o carregados aqui -->
        </div>
    </main>

    <!-- Carrinho Flutuante -->
    <div id="carrinho-flutuante" class="fixed bottom-4 right-4 bg-primary text-white px-6 py-3 rounded-full shadow-lg cursor-pointer hidden" onclick="abrirCarrinho()">
        <div class="flex items-center space-x-2">
            <span>üõí</span>
            <span id="carrinho-count">0</span>
            <span>itens - R$ <span id="carrinho-total">0,00</span></span>
        </div>
    </div>

    <!-- Modal do Carrinho -->
    <div id="modal-carrinho" class="modal">
        <div class="bg-white rounded-lg max-w-md w-full mx-4 max-h-[90vh] overflow-y-auto">
            <div class="p-6">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-xl font-bold">Seu Carrinho</h3>
                    <button onclick="fecharModal('modal-carrinho')" class="text-gray-500 hover:text-gray-700">‚úï</button>
                </div>
                
                <div id="itens-carrinho" class="space-y-4 mb-6">
                    <!-- Itens do carrinho ser√£o renderizados aqui -->
                </div>
                
                <div class="border-t pt-4 mb-6">
                    <div class="flex justify-between items-center font-bold text-lg">
                        <span>Total:</span>
                        <span class="text-primary">R$ <span id="total-carrinho-modal">0,00</span></span>
                    </div>
                </div>
                
                <div class="flex space-x-3">
                    <button onclick="limparCarrinho()" class="flex-1 bg-gray-200 text-gray-700 py-3 rounded-lg font-medium hover:bg-gray-300 transition-colors">
                        Limpar
                    </button>
                    <button onclick="abrirCheckout()" class="flex-1 bg-primary text-white py-3 rounded-lg font-medium hover:bg-orange-600 transition-colors">
                        Finalizar
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Observa√ß√µes Item -->
    <div id="modal-observacoes-item" class="modal">
        <div class="bg-white rounded-lg max-w-md w-full mx-4">
            <div class="p-6">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-lg font-bold">Observa√ß√µes do Item</h3>
                    <button onclick="fecharModal('modal-observacoes-item')" class="text-gray-500 hover:text-gray-700">‚úï</button>
                </div>
                
                <textarea id="observacoes-item-edit" placeholder="Digite suas observa√ß√µes..." class="w-full p-3 border rounded-lg resize-none mb-4" rows="4"></textarea>
                
                <div class="flex space-x-3">
                    <button onclick="fecharModal('modal-observacoes-item')" class="flex-1 bg-gray-200 text-gray-700 py-3 rounded-lg font-medium hover:bg-gray-300 transition-colors">
                        Cancelar
                    </button>
                    <button onclick="salvarObservacoes()" class="flex-1 bg-primary text-white py-3 rounded-lg font-medium hover:bg-orange-600 transition-colors">
                        Salvar
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal do Produto -->
    <div id="modal-produto" class="modal">
        <div class="bg-white rounded-lg max-w-md w-full mx-4 max-h-[90vh] overflow-y-auto">
            <div class="p-6">
                <div class="flex justify-between items-start mb-4">
                    <h3 id="modal-titulo" class="text-xl font-bold"></h3>
                    <button onclick="fecharModal('modal-produto')" class="text-gray-500 hover:text-gray-700">‚úï</button>
                </div>
                <img id="modal-imagem" src="" alt="" class="w-full h-48 object-cover rounded-lg mb-4">
                <p id="modal-descricao" class="text-gray-600 mb-4"></p>
                <!-- Varia√ß√µes do Produto -->
                <div id="variacoes-container" class="mb-4 hidden">
                    <h4 class="font-medium mb-3">Escolha uma op√ß√£o:</h4>
                    <div id="variacoes-lista" class="space-y-2">
                        <!-- Varia√ß√µes ser√£o carregadas aqui -->
                    </div>
                </div>

                <div class="flex items-center justify-between mb-4">
                    <span class="text-2xl font-bold text-primary">R$ <span id="modal-preco">0,00</span></span>
                </div>
                <div class="flex items-center justify-between mb-6">
                    <span class="font-medium">Quantidade:</span>
                    <div class="flex items-center space-x-3">
                        <button onclick="alterarQuantidade(-1)" class="w-8 h-8 bg-gray-200 rounded-full flex items-center justify-center">-</button>
                        <span id="quantidade-modal" class="font-bold">1</span>
                        <button onclick="alterarQuantidade(1)" class="w-8 h-8 bg-primary text-white rounded-full flex items-center justify-center">+</button>
                    </div>
                </div>
                <textarea id="observacoes-produto" placeholder="Observa√ß√µes (opcional)" class="w-full p-3 border rounded-lg mb-4 resize-none"></textarea>
                <button onclick="adicionarAoCarrinho()" class="w-full bg-primary text-white py-3 rounded-lg font-medium hover:bg-orange-600 transition-colors">
                    Adicionar ao Carrinho - R$ <span id="total-modal">0,00</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Modal Checkout Passo 1 -->
    <div id="modal-checkout-1" class="modal">
        <div class="bg-white rounded-lg max-w-md w-full mx-4 max-h-[90vh] overflow-y-auto">
            <div class="p-6">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-xl font-bold">Finalizar Pedido</h3>
                    <button onclick="fecharModal('modal-checkout-1')" class="text-gray-500 hover:text-gray-700">‚úï</button>
                </div>
                
                <div class="mb-6">
                    <h4 class="font-medium mb-3">Tipo de Recebimento:</h4>
                    <div class="space-y-2">
                        <label class="flex items-center space-x-3 p-3 border rounded-lg cursor-pointer hover:bg-gray-50">
                            <input type="radio" name="tipo-recebimento" value="delivery" class="text-primary">
                            <span id="opcao-1">Delivery</span>
                        </label>
                        <label class="flex items-center space-x-3 p-3 border rounded-lg cursor-pointer hover:bg-gray-50">
                            <input type="radio" name="tipo-recebimento" value="retirada" class="text-primary">
                            <span id="opcao-2">Retirada</span>
                        </label>
                        <label class="flex items-center space-x-3 p-3 border rounded-lg cursor-pointer hover:bg-gray-50">
                            <input type="radio" name="tipo-recebimento" value="balcao" class="text-primary">
                            <span id="opcao-3">Balc√£o</span>
                        </label>
                        <label class="flex items-center space-x-3 p-3 border rounded-lg cursor-pointer hover:bg-gray-50">
                            <input type="radio" name="tipo-recebimento" value="mesa" class="text-primary">
                            <span id="opcao-4">Mesa</span>
                        </label>
                    </div>
                </div>

                <div id="endereco-section" class="mb-6 hidden">
                    <h4 class="font-medium mb-3">Endere√ßo de Entrega:</h4>
                    <div class="space-y-3">
                        <input type="text" id="cep" placeholder="CEP" class="w-full p-3 border rounded-lg" onblur="buscarCEP()">
                        <input type="text" id="endereco" placeholder="Endere√ßo" class="w-full p-3 border rounded-lg" readonly>
                        <div class="flex space-x-2">
                            <input type="text" id="numero" placeholder="N√∫mero" class="w-1/2 p-3 border rounded-lg">
                            <input type="text" id="complemento" placeholder="Complemento" class="w-1/2 p-3 border rounded-lg">
                        </div>
                        <input type="text" id="bairro" placeholder="Bairro" class="w-full p-3 border rounded-lg" readonly>
                        <input type="text" id="cidade" placeholder="Cidade" class="w-full p-3 border rounded-lg" readonly>
                    </div>
                </div>

                <div class="border-t pt-4 mb-6">
                    <div class="flex justify-between items-center mb-2">
                        <span>Subtotal:</span>
                        <span>R$ <span id="subtotal-checkout">0,00</span></span>
                    </div>
                    <div id="taxa-delivery-line" class="flex justify-between items-center mb-2 hidden">
                        <span>Taxa de Entrega:</span>
                        <span>R$ <span id="taxa-delivery">0,00</span></span>
                    </div>
                    <div class="flex justify-between items-center font-bold text-lg">
                        <span>Total:</span>
                        <span class="text-primary">R$ <span id="total-checkout">0,00</span></span>
                    </div>
                </div>

                <button onclick="proximoPasso()" class="w-full bg-primary text-white py-3 rounded-lg font-medium hover:bg-orange-600 transition-colors">
                    Continuar
                </button>
            </div>
        </div>
    </div>

    <!-- Modal Checkout Passo 2 -->
    <div id="modal-checkout-2" class="modal">
        <div class="bg-white rounded-lg max-w-md w-full mx-4 max-h-[90vh] overflow-y-auto">
            <div class="p-6">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-xl font-bold">Dados do Pedido</h3>
                    <button onclick="fecharModal('modal-checkout-2')" class="text-gray-500 hover:text-gray-700">‚úï</button>
                </div>
                
                <div class="space-y-4 mb-6">
                    <div>
                        <label class="block text-sm font-medium mb-2">Nome *</label>
                        <input type="text" id="nome-cliente" placeholder="Seu nome completo" class="w-full p-3 border rounded-lg" required>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium mb-2">WhatsApp *</label>
                        <input type="tel" id="whatsapp-cliente" placeholder="(11) 99999-9999" class="w-full p-3 border rounded-lg" required>
                    </div>
                    
                    <div id="forma-pagamento-section">
                        <label class="block text-sm font-medium mb-2">Forma de Pagamento *</label>
                        <select id="forma-pagamento" class="w-full p-3 border rounded-lg" required>
                            <option value="">Selecione...</option>
                        </select>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium mb-2">Observa√ß√µes</label>
                        <textarea id="observacoes-pedido" placeholder="Observa√ß√µes sobre o pedido" class="w-full p-3 border rounded-lg resize-none" rows="3"></textarea>
                    </div>
                </div>

                <div class="border-t pt-4 mb-6">
                    <div class="flex justify-between items-center font-bold text-lg">
                        <span>Total Final:</span>
                        <span class="text-primary">R$ <span id="total-final">0,00</span></span>
                    </div>
                </div>

                <div class="flex space-x-3">
                    <button onclick="voltarPasso()" class="flex-1 bg-gray-200 text-gray-700 py-3 rounded-lg font-medium hover:bg-gray-300 transition-colors">
                        Voltar
                    </button>
                    <button onclick="finalizarPedido()" class="flex-1 bg-green-600 text-white py-3 rounded-lg font-medium hover:bg-green-700 transition-colors">
                        Finalizar Pedido
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="bg-gray-800 text-white mt-16">
        <div class="max-w-6xl mx-auto px-4 py-8">
            <div class="grid md:grid-cols-3 gap-8">
                <!-- Se√ß√£o 1: Avalia√ß√£o Google -->
                <div class="bg-gray-700 p-6 rounded-lg">
                    <h3 class="text-lg font-bold mb-4">Avalie-nos no Google</h3>
                    <p class="text-gray-300 mb-4">Sua opini√£o √© muito importante para n√≥s!</p>
                    <a id="link-google-negocio" href="#" target="_blank" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors inline-block">
                        ‚≠ê Avaliar no Google
                    </a>
                </div>

                <!-- Se√ß√£o 2: Contato -->
                <div>
                    <h3 class="text-lg font-bold mb-4">Contato</h3>
                    <div class="space-y-2 text-gray-300">
                        <p id="endereco-contato">üìç Carregando endere√ßo...</p>
                        <p id="telefone-contato">üìû Carregando telefone...</p>
                        <p id="whatsapp-contato">üì± Carregando WhatsApp...</p>
                        <p id="email-contato">‚úâÔ∏è Carregando email...</p>
                    </div>
                </div>

                <!-- Se√ß√£o 3: Copyright -->
                <div>
                    <h3 class="text-lg font-bold mb-4">Redes Sociais</h3>
                    <div class="flex space-x-4 mb-6">
                        <a id="link-instagram" href="#" target="_blank" class="text-pink-400 hover:text-pink-300">üì∑ Instagram</a>
                        <a id="link-facebook" href="#" target="_blank" class="text-blue-400 hover:text-blue-300">üìò Facebook</a>
                    </div>
                    <div class="text-sm text-gray-400">
                        <p>&copy; <span id="ano-atual"></span> Todos os direitos reservados</p>
                        <p class="mt-2">Desenvolvido com ‚ù§Ô∏è pela <a href="https://agenciapitoresco.com.br" target="_blank" class="text-primary hover:text-secondary">Ag√™ncia Pitoresco</a></p>
                    </div>
                </div>
            </div>
        </div>
    </footer>

    <script>
        // Vari√°veis globais
        let dadosConfig = {};
        let categorias = [];
        let produtos = [];
        let horarios = [];
        let carrinho = [];
        let produtoAtual = null;
        let quantidadeModal = 1;
        let variacaoSelecionada = null;
        let filtroAtivo = 'todos';
        let itemEditandoObservacao = null;

        // Inicializa√ß√£o
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('ano-atual').textContent = new Date().getFullYear();
            carregarDados();
        });

        // Fun√ß√£o para carregar dados das planilhas
        async function carregarDados() {
            try {
                await Promise.all([
                    carregarConfiguracoes(),
                    carregarCategorias(),
                    carregarProdutos(),
                    carregarHorarios()
                ]);
                
                aplicarConfiguracoes();
                verificarHorarioFuncionamento();
                renderizarCategorias();
                renderizarProdutos();
                configurarBusca();
            } catch (error) {
                console.error('Erro ao carregar dados:', error);
            }
        }

        async function carregarConfiguracoes() {
            try {
                const response = await fetch('https://docs.google.com/spreadsheets/d/e/2PACX-1vTIeGjTFrU4kMqWvrOa1hniNuBkB8fVEiktGH19YUlJNU3aU1uODB935WuDHtGVGzz3r3-vYS2v3V6e/pub?gid=1784216677&single=true&output=csv');
                const csv = await response.text();
                const linhas = csv.split('\n').slice(1);
                
                dadosConfig = {};
                linhas.forEach(linha => {
                    const colunas = linha.split(',');
                    const section = colunas[0]?.replace(/"/g, '');
                    const key = colunas[1]?.replace(/"/g, '');
                    const value = colunas[2]?.replace(/"/g, '');
                    
                    if (section && key && value) {
                        if (!dadosConfig[section]) dadosConfig[section] = {};
                        dadosConfig[section][key] = value;
                    }
                });
            } catch (error) {
                console.error('Erro ao carregar configura√ß√µes:', error);
                // Dados de fallback
                dadosConfig = {
                    identidade_visual: {
                        nome_empresa: 'Restaurante Demo',
                        slogan: 'Comida deliciosa sempre!'
                    },
                    contato: {
                        whatsapp: '11999999999'
                    }
                };
            }
        }



        async function carregarCategorias() {
            try {
                const response = await fetch('https://docs.google.com/spreadsheets/d/e/2PACX-1vTIeGjTFrU4kMqWvrOa1hniNuBkB8fVEiktGH19YUlJNU3aU1uODB935WuDHtGVGzz3r3-vYS2v3V6e/pub?gid=980375903&single=true&output=csv');
                const csv = await response.text();
                const linhas = csv.split('\n');
                const headers = linhas[0].split(',').map(h => h.replace(/"/g, ''));
                
                categorias = linhas.slice(1).map(linha => {
                    const valores = linha.split(',');
                    const categoria = {};
                    headers.forEach((header, index) => {
                        categoria[header] = valores[index]?.replace(/"/g, '') || '';
                    });
                    return categoria;
                }).filter(cat => cat.status === 'ativo');
                
                categorias.sort((a, b) => parseInt(a.ordem || 0) - parseInt(b.ordem || 0));
            } catch (error) {
                console.error('Erro ao carregar categorias:', error);
                // Dados de fallback
                categorias = [
                    { nome_categoria: 'Pratos Principais', titulo_exibicao: 'Pratos Principais', status: 'ativo', ordem: '1' },
                    { nome_categoria: 'Bebidas', titulo_exibicao: 'Bebidas', status: 'ativo', ordem: '2' },
                    { nome_categoria: 'Sobremesas', titulo_exibicao: 'Sobremesas', status: 'ativo', ordem: '3' }
                ];
            }
        }

        async function carregarProdutos() {
            try {
                const response = await fetch('https://docs.google.com/spreadsheets/d/e/2PACX-1vTIeGjTFrU4kMqWvrOa1hniNuBkB8fVEiktGH19YUlJNU3aU1uODB935WuDHtGVGzz3r3-vYS2v3V6e/pub?gid=0&single=true&output=csv');
                const csv = await response.text();
                const linhas = csv.split('\n');
                const headers = linhas[0].split(',').map(h => h.replace(/"/g, ''));
                
                produtos = linhas.slice(1).map(linha => {
                    const valores = linha.split(',');
                    const produto = {};
                    headers.forEach((header, index) => {
                        produto[header] = valores[index]?.replace(/"/g, '') || '';
                    });
                    return produto;
                }).filter(prod => prod.status === 'ativo');
            } catch (error) {
                console.error('Erro ao carregar produtos:', error);
                // Dados de fallback
                produtos = [
                    { 
                        item: 'Hamb√∫rguer Cl√°ssico', 
                        descricao: 'Hamb√∫rguer artesanal com queijo, alface e tomate',
                        preco: '25.90',
                        categoria: 'Pratos Principais',
                        status: 'ativo',
                        classificacao_adicional: 'promocao'
                    },
                    { 
                        item: 'Pizza Margherita', 
                        descricao: 'Pizza tradicional com molho de tomate, mussarela e manjeric√£o',
                        preco: '32.50',
                        categoria: 'Pratos Principais',
                        status: 'ativo',
                        classificacao_adicional: 'vegano'
                    },
                    { 
                        item: 'Refrigerante Lata', 
                        descricao: 'Coca-Cola, Pepsi ou Guaran√° 350ml',
                        preco: '5.50',
                        categoria: 'Bebidas',
                        status: 'ativo',
                        classificacao_adicional: ''
                    }
                ];
            }
        }

        async function carregarHorarios() {
            try {
                const response = await fetch('https://docs.google.com/spreadsheets/d/e/2PACX-1vTIeGjTFrU4kMqWvrOa1hniNuBkB8fVEiktGH19YUlJNU3aU1uODB935WuDHtGVGzz3r3-vYS2v3V6e/pub?gid=1340217659&single=true&output=csv');
                const csv = await response.text();
                const linhas = csv.split('\n');
                const headers = linhas[0].split(',').map(h => h.replace(/"/g, ''));
                
                horarios = linhas.slice(1).map(linha => {
                    const valores = linha.split(',');
                    const horario = {};
                    headers.forEach((header, index) => {
                        horario[header] = valores[index]?.replace(/"/g, '') || '';
                    });
                    return horario;
                });
            } catch (error) {
                console.error('Erro ao carregar hor√°rios:', error);
                // Dados de fallback
                horarios = [
                    { dia_semana: 'segunda', abertura: '11:00', fechamento: '22:00', status: 'aberto' },
                    { dia_semana: 'terca', abertura: '11:00', fechamento: '22:00', status: 'aberto' },
                    { dia_semana: 'quarta', abertura: '11:00', fechamento: '22:00', status: 'aberto' },
                    { dia_semana: 'quinta', abertura: '11:00', fechamento: '22:00', status: 'aberto' },
                    { dia_semana: 'sexta', abertura: '11:00', fechamento: '23:00', status: 'aberto' },
                    { dia_semana: 'sabado', abertura: '11:00', fechamento: '23:00', status: 'aberto' },
                    { dia_semana: 'domingo', abertura: '11:00', fechamento: '21:00', status: 'aberto' }
                ];
            }
        }



        function aplicarConfiguracoes() {
            // Aplicar configura√ß√µes visuais
            if (dadosConfig.identidade_visual) {
                document.getElementById('nome-empresa').textContent = dadosConfig.identidade_visual.nome_empresa || 'Restaurante';
                document.getElementById('slogan').textContent = dadosConfig.identidade_visual.slogan || 'Slogan do restaurante';
                document.getElementById('logo').src = dadosConfig.identidade_visual.logo_url || 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAiIGhlaWdodD0iNDAiIHZpZXdCb3g9IjAgMCA0MCA0MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPGNpcmNsZSBjeD0iMjAiIGN5PSIyMCIgcj0iMjAiIGZpbGw9IiNGRjZCMzUiLz4KPHN2ZyB3aWR0aD0iMjQiIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4PSI4IiB5PSI4Ij4KPHBhdGggZD0iTTEyIDJMMTMuMDkgOC4yNkwyMCA5TDEzLjA5IDE1Ljc0TDEyIDIyTDEwLjkxIDE1Ljc0TDQgOUwxMC45MSA4LjI2TDEyIDJaIiBmaWxsPSJ3aGl0ZSIvPgo8L3N2Zz4KPC9zdmc+';
            }

            // Aplicar informa√ß√µes de contato
            if (dadosConfig.contato) {
                document.getElementById('endereco-contato').textContent = `üìç ${dadosConfig.contato.endereco_completo || 'Endere√ßo n√£o informado'}`;
                document.getElementById('telefone-contato').textContent = `üìû ${dadosConfig.contato.telefone || 'Telefone n√£o informado'}`;
                document.getElementById('whatsapp-contato').textContent = `üì± ${dadosConfig.contato.whatsapp || 'WhatsApp n√£o informado'}`;
                document.getElementById('email-contato').textContent = `‚úâÔ∏è ${dadosConfig.contato.email || 'Email n√£o informado'}`;
            }

            // Aplicar links de redes sociais
            if (dadosConfig.redes_sociais) {
                document.getElementById('link-instagram').href = dadosConfig.redes_sociais.instagram_url || '#';
                document.getElementById('link-facebook').href = dadosConfig.redes_sociais.facebook_url || '#';
                document.getElementById('link-google-negocio').href = dadosConfig.redes_sociais.google_negocio_url || '#';
            }

            // Aplicar op√ß√µes de checkout
            if (dadosConfig.checkout) {
                document.getElementById('opcao-1').textContent = dadosConfig.checkout.step2_opc1 || 'Delivery';
                document.getElementById('opcao-2').textContent = dadosConfig.checkout.step2_opc2 || 'Retirada';
                document.getElementById('opcao-3').textContent = dadosConfig.checkout.step2_opc3 || 'Balc√£o';
                document.getElementById('opcao-4').textContent = dadosConfig.checkout.step2_opc4 || 'Mesa';

                // Carregar formas de pagamento
                if (dadosConfig.checkout.step3_formas_pag) {
                    const formasPagamento = dadosConfig.checkout.step3_formas_pag.split('|');
                    const select = document.getElementById('forma-pagamento');
                    formasPagamento.forEach(forma => {
                        const option = document.createElement('option');
                        option.value = forma.trim();
                        option.textContent = forma.trim();
                        select.appendChild(option);
                    });
                }
            }
        }

        function renderizarCategorias() {
            const container = document.getElementById('categorias-menu');
            container.innerHTML = '';

            categorias.forEach(categoria => {
                const button = document.createElement('button');
                button.className = 'px-4 py-2 text-sm font-medium text-gray-600 hover:text-primary border-b-2 border-transparent hover:border-primary transition-colors whitespace-nowrap';
                button.textContent = categoria.titulo_exibicao || categoria.nome_categoria;
                button.onclick = () => scrollToCategory(categoria.nome_categoria);
                container.appendChild(button);
            });
        }



        function renderizarProdutos() {
            const container = document.getElementById('produtos-container');
            container.innerHTML = '';

            categorias.forEach(categoria => {
                const produtosCategoria = produtos.filter(p => p.categoria === categoria.nome_categoria);
                
                if (produtosCategoria.length > 0) {
                    const section = document.createElement('section');
                    section.id = `categoria-${categoria.nome_categoria}`;
                    section.className = 'mb-8';

                    const titulo = document.createElement('h2');
                    titulo.className = 'text-2xl font-bold text-gray-800 mb-6';
                    titulo.textContent = categoria.titulo_exibicao || categoria.nome_categoria;
                    section.appendChild(titulo);

                    const grid = document.createElement('div');
                    grid.className = 'grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6';

                    produtosCategoria.forEach(produto => {
                        const card = criarCardProduto(produto);
                        grid.appendChild(card);
                    });

                    section.appendChild(grid);
                    container.appendChild(section);
                }
            });
        }



        function criarCardProduto(produto) {
            const card = document.createElement('div');
            card.className = 'bg-white rounded-lg shadow-md overflow-hidden cursor-pointer product-card transition-all duration-300 relative';
            card.onclick = () => abrirModalProduto(produto);

            const imagemUrl = produto.imagem_link || 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgdmlld0JveD0iMCAwIDIwMCAyMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIyMDAiIGhlaWdodD0iMjAwIiBmaWxsPSIjRjNGNEY2Ii8+CjxwYXRoIGQ9Ik0xMDAgNzBDMTA4LjI4NCA3MCA5NS4wNzE2IDc2LjE5MjUgMTAwIDg1QzEwNC45MjggNzYuMTkyNSA5MS43MTU3IDcwIDEwMCA3MFoiIGZpbGw9IiM5Q0EzQUYiLz4KPHBhdGggZD0iTTEwMCAxMzBDMTA4LjI4NCAxMzAgOTUuMDcxNiAxMjMuODA3IDEwMCAxMTVDMTA0LjkyOCAxMjMuODA3IDkxLjcxNTcgMTMwIDEwMCAxMzBaIiBmaWxsPSIjOUNBM0FGIi8+Cjx0ZXh0IHg9IjEwMCIgeT0iMTYwIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBmaWxsPSIjNjc3NDhGIiBmb250LXNpemU9IjE0Ij5Qcm9kdXRvPC90ZXh0Pgo8L3N2Zz4=';

            // Badges de classifica√ß√£o
            let badges = '';
            if (produto.classificacao_adicional) {
                const classificacoes = produto.classificacao_adicional.toLowerCase();
                if (classificacoes.includes('promocao')) {
                    badges += '<div class="absolute top-2 left-2 bg-red-500 text-white px-2 py-1 rounded-full text-xs font-bold">üî• PROMO√á√ÉO</div>';
                }
                if (classificacoes.includes('novidade')) {
                    badges += '<div class="absolute top-2 right-2 bg-yellow-500 text-white px-2 py-1 rounded-full text-xs font-bold">‚≠ê NOVO</div>';
                }
                if (classificacoes.includes('vegano')) {
                    badges += '<div class="absolute bottom-2 left-2 bg-green-500 text-white px-2 py-1 rounded-full text-xs font-bold">üå± VEGANO</div>';
                }
            }

            card.innerHTML = `
                <div class="aspect-square overflow-hidden relative">
                    <img src="${imagemUrl}" alt="${produto.item}" class="w-full h-full object-cover hover:scale-105 transition-transform duration-300">
                    ${badges}
                </div>
                <div class="p-4">
                    <h3 class="font-bold text-lg text-gray-800 mb-2">${produto.item}</h3>
                    <p class="text-gray-600 text-sm mb-3 line-clamp-2">${produto.descricao}</p>
                    <div class="flex items-center justify-between">
                        <span class="text-xl font-bold text-primary">R$ ${parseFloat(produto.preco).toFixed(2).replace('.', ',')}</span>
                        <button class="bg-primary text-white px-4 py-2 rounded-lg hover:bg-orange-600 transition-colors">
                            Adicionar
                        </button>
                    </div>
                </div>
            `;

            return card;
        }

        function scrollToCategory(categoria) {
            const element = document.getElementById(`categoria-${categoria}`);
            if (element) {
                element.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }
        }

        function abrirModalProduto(produto) {
            produtoAtual = produto;
            quantidadeModal = 1;
            
            document.getElementById('modal-titulo').textContent = produto.item;
            document.getElementById('modal-descricao').textContent = produto.descricao;
            document.getElementById('modal-preco').textContent = parseFloat(produto.preco).toFixed(2).replace('.', ',');
            document.getElementById('quantidade-modal').textContent = quantidadeModal;
            document.getElementById('total-modal').textContent = parseFloat(produto.preco).toFixed(2).replace('.', ',');
            document.getElementById('observacoes-produto').value = '';
            
            const imagemUrl = produto.imagem_link || 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgdmlld0JveD0iMCAwIDIwMCAyMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIyMDAiIGhlaWdodD0iMjAwIiBmaWxsPSIjRjNGNEY2Ii8+CjxwYXRoIGQ9Ik0xMDAgNzBDMTA4LjI4NCA3MCA5NS4wNzE2IDc2LjE5MjUgMTAwIDg1QzEwNC45MjggNzYuMTkyNSA5MS43MTU3IDcwIDEwMCA3MFoiIGZpbGw9IiM5Q0EzQUYiLz4KPHBhdGggZD0iTTEwMCAxMzBDMTA4LjI4NCAxMzAgOTUuMDcxNiAxMjMuODA3IDEwMCAxMTVDMTA0LjkyOCAxMjMuODA3IDkxLjcxNTcgMTMwIDEwMCAxMzBaIiBmaWxsPSIjOUNBM0FGIi8+Cjx0ZXh0IHg9IjEwMCIgeT0iMTYwIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBmaWxsPSIjNjc3NDhGIiBmb250LXNpemU9IjE0Ij5Qcm9kdXRvPC90ZXh0Pgo8L3N2Zz4=';
            document.getElementById('modal-imagem').src = imagemUrl;
            
            document.getElementById('modal-produto').classList.add('active');
        }

        function alterarQuantidade(delta) {
            quantidadeModal = Math.max(1, quantidadeModal + delta);
            document.getElementById('quantidade-modal').textContent = quantidadeModal;
            
            const total = parseFloat(produtoAtual.preco) * quantidadeModal;
            document.getElementById('total-modal').textContent = total.toFixed(2).replace('.', ',');
        }

        function adicionarAoCarrinho() {
            const observacoes = document.getElementById('observacoes-produto').value;
            
            const itemCarrinho = {
                id: Date.now(),
                produto: produtoAtual,
                quantidade: quantidadeModal,
                observacoes: observacoes,
                total: parseFloat(produtoAtual.preco) * quantidadeModal
            };
            
            carrinho.push(itemCarrinho);
            atualizarCarrinho();
            fecharModal('modal-produto');
        }

        function atualizarCarrinho() {
            const totalItens = carrinho.reduce((sum, item) => sum + item.quantidade, 0);
            const totalValor = carrinho.reduce((sum, item) => sum + item.total, 0);
            
            document.getElementById('carrinho-count').textContent = totalItens;
            document.getElementById('carrinho-total').textContent = totalValor.toFixed(2).replace('.', ',');
            
            const carrinhoFlutuante = document.getElementById('carrinho-flutuante');
            if (totalItens > 0) {
                carrinhoFlutuante.classList.remove('hidden');
                carrinhoFlutuante.classList.add('cart-badge');
                setTimeout(() => carrinhoFlutuante.classList.remove('cart-badge'), 500);
            } else {
                carrinhoFlutuante.classList.add('hidden');
            }
            
            renderizarItensCarrinho();
        }

        function abrirCarrinho() {
            if (carrinho.length === 0) return;
            document.getElementById('modal-carrinho').classList.add('active');
        }

        function renderizarItensCarrinho() {
            const container = document.getElementById('itens-carrinho');
            const totalModal = document.getElementById('total-carrinho-modal');
            
            if (carrinho.length === 0) {
                container.innerHTML = '<p class="text-gray-500 text-center py-8">Carrinho vazio</p>';
                totalModal.textContent = '0,00';
                return;
            }
            
            container.innerHTML = '';
            let total = 0;
            
            carrinho.forEach((item, index) => {
                total += item.total;
                
                const itemDiv = document.createElement('div');
                itemDiv.className = 'flex items-center space-x-3 p-3 border rounded-lg';
                
                itemDiv.innerHTML = `
                    <img src="${item.produto.imagem_link || 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAiIGhlaWdodD0iNDAiIHZpZXdCb3g9IjAgMCA0MCA0MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjQwIiBoZWlnaHQ9IjQwIiBmaWxsPSIjRjNGNEY2Ii8+CjxwYXRoIGQ9Ik0yMCAxNUMyMi4yMDkxIDE1IDE5LjAzNTggMTcuMDk2MyAyMCAyMEMyMC45NjQyIDE3LjA5NjMgMTcuNzkwOSAxNSAyMCAxNVoiIGZpbGw9IiM5Q0EzQUYiLz4KPC9zdmc+'}" alt="${item.produto.item}" class="w-12 h-12 object-cover rounded">
                    <div class="flex-1">
                        <h4 class="font-medium text-sm">${item.produto.item}</h4>
                        ${item.observacoes ? `<p class="text-xs text-gray-500">${item.observacoes}</p>` : ''}
                        <div class="flex items-center justify-between mt-1">
                            <div class="flex items-center space-x-2">
                                <button onclick="alterarQuantidadeCarrinho(${index}, -1)" class="w-6 h-6 bg-gray-200 rounded-full flex items-center justify-center text-sm">-</button>
                                <span class="text-sm font-medium">${item.quantidade}</span>
                                <button onclick="alterarQuantidadeCarrinho(${index}, 1)" class="w-6 h-6 bg-primary text-white rounded-full flex items-center justify-center text-sm">+</button>
                            </div>
                            <span class="text-sm font-bold text-primary">R$ ${item.total.toFixed(2).replace('.', ',')}</span>
                        </div>
                    </div>
                    <div class="flex flex-col space-y-1">
                        <button onclick="editarObservacoes(${index})" class="text-xs text-blue-600 hover:text-blue-800">üìù</button>
                        <button onclick="removerItemCarrinho(${index})" class="text-xs text-red-600 hover:text-red-800">üóëÔ∏è</button>
                    </div>
                `;
                
                container.appendChild(itemDiv);
            });
            
            totalModal.textContent = total.toFixed(2).replace('.', ',');
        }

        function alterarQuantidadeCarrinho(index, delta) {
            if (carrinho[index]) {
                carrinho[index].quantidade = Math.max(1, carrinho[index].quantidade + delta);
                carrinho[index].total = parseFloat(carrinho[index].produto.preco) * carrinho[index].quantidade;
                atualizarCarrinho();
            }
        }

        function removerItemCarrinho(index) {
            carrinho.splice(index, 1);
            atualizarCarrinho();
        }

        function editarObservacoes(index) {
            itemEditandoObservacao = index;
            document.getElementById('observacoes-item-edit').value = carrinho[index].observacoes || '';
            document.getElementById('modal-observacoes-item').classList.add('active');
        }

        function salvarObservacoes() {
            if (itemEditandoObservacao !== null) {
                carrinho[itemEditandoObservacao].observacoes = document.getElementById('observacoes-item-edit').value;
                renderizarItensCarrinho();
                fecharModal('modal-observacoes-item');
                itemEditandoObservacao = null;
            }
        }

        function limparCarrinho() {
            if (confirm('Deseja limpar o carrinho?')) {
                carrinho = [];
                atualizarCarrinho();
                fecharModal('modal-carrinho');
            }
        }

        function compartilharCardapio() {
            const url = window.location.href;
            const texto = `Confira nosso card√°pio digital! ${dadosConfig.identidade_visual?.nome_empresa || 'Restaurante'}`;
            
            if (navigator.share) {
                navigator.share({
                    title: dadosConfig.identidade_visual?.nome_empresa || 'Card√°pio Digital',
                    text: texto,
                    url: url
                });
            } else {
                // Fallback para WhatsApp
                const whatsappUrl = `https://wa.me/?text=${encodeURIComponent(texto + ' ' + url)}`;
                window.open(whatsappUrl, '_blank');
            }
        }

        function abrirCheckout() {
            if (carrinho.length === 0) return;
            
            fecharModal('modal-carrinho');
            
            const subtotal = carrinho.reduce((sum, item) => sum + item.total, 0);
            document.getElementById('subtotal-checkout').textContent = subtotal.toFixed(2).replace('.', ',');
            document.getElementById('total-checkout').textContent = subtotal.toFixed(2).replace('.', ',');
            
            document.getElementById('modal-checkout-1').classList.add('active');
        }

        function proximoPasso() {
            const tipoRecebimento = document.querySelector('input[name="tipo-recebimento"]:checked');
            if (!tipoRecebimento) {
                alert('Selecione o tipo de recebimento');
                return;
            }

            // Verificar se √© delivery e validar endere√ßo
            if (tipoRecebimento.value === 'delivery') {
                const cep = document.getElementById('cep').value;
                const numero = document.getElementById('numero').value;
                if (!cep || !numero) {
                    alert('Preencha o endere√ßo completo para delivery');
                    return;
                }
            }

            // Calcular total com taxa de delivery se aplic√°vel
            let subtotal = carrinho.reduce((sum, item) => sum + item.total, 0);
            let taxaDelivery = 0;
            
            if (tipoRecebimento.value === 'delivery' && dadosConfig.checkout?.step2_taxa_delivery) {
                taxaDelivery = parseFloat(dadosConfig.checkout.step2_taxa_delivery);
            }
            
            const totalFinal = subtotal + taxaDelivery;
            document.getElementById('total-final').textContent = totalFinal.toFixed(2).replace('.', ',');
            
            fecharModal('modal-checkout-1');
            document.getElementById('modal-checkout-2').classList.add('active');
        }

        function voltarPasso() {
            fecharModal('modal-checkout-2');
            document.getElementById('modal-checkout-1').classList.add('active');
        }

        async function finalizarPedido() {
            const nome = document.getElementById('nome-cliente').value;
            const whatsapp = document.getElementById('whatsapp-cliente').value;
            const formaPagamento = document.getElementById('forma-pagamento').value;
            
            if (!nome || !whatsapp || !formaPagamento) {
                alert('Preencha todos os campos obrigat√≥rios');
                return;
            }

            // Salvar cliente na planilha (simula√ß√£o)
            try {
                await salvarCliente(nome, whatsapp);
            } catch (error) {
                console.error('Erro ao salvar cliente:', error);
            }

            // Preparar mensagem do pedido
            const tipoRecebimento = document.querySelector('input[name="tipo-recebimento"]:checked').value;
            const observacoesPedido = document.getElementById('observacoes-pedido').value;
            
            let mensagem = `üçΩÔ∏è *NOVO PEDIDO*\n\n`;
            mensagem += `üë§ *Cliente:* ${nome}\n`;
            mensagem += `üì± *WhatsApp:* ${whatsapp}\n`;
            mensagem += `üöö *Tipo:* ${tipoRecebimento}\n`;
            mensagem += `üí≥ *Pagamento:* ${formaPagamento}\n\n`;
            
            if (tipoRecebimento === 'delivery') {
                const endereco = document.getElementById('endereco').value;
                const numero = document.getElementById('numero').value;
                const complemento = document.getElementById('complemento').value;
                const bairro = document.getElementById('bairro').value;
                const cidade = document.getElementById('cidade').value;
                
                mensagem += `üìç *Endere√ßo:*\n${endereco}, ${numero}${complemento ? ` - ${complemento}` : ''}\n${bairro} - ${cidade}\n\n`;
            }
            
            mensagem += `üõí *Itens do Pedido:*\n`;
            carrinho.forEach(item => {
                mensagem += `‚Ä¢ ${item.quantidade}x ${item.produto.item} - R$ ${item.total.toFixed(2).replace('.', ',')}\n`;
                if (item.observacoes) {
                    mensagem += `  üìù ${item.observacoes}\n`;
                }
            });
            
            const subtotal = carrinho.reduce((sum, item) => sum + item.total, 0);
            let taxaDelivery = 0;
            if (tipoRecebimento === 'delivery' && dadosConfig.checkout?.step2_taxa_delivery) {
                taxaDelivery = parseFloat(dadosConfig.checkout.step2_taxa_delivery);
                mensagem += `\nüöö Taxa de Entrega: R$ ${taxaDelivery.toFixed(2).replace('.', ',')}\n`;
            }
            
            const totalFinal = subtotal + taxaDelivery;
            mensagem += `\nüí∞ *Total: R$ ${totalFinal.toFixed(2).replace('.', ',')}*\n`;
            
            if (observacoesPedido) {
                mensagem += `\nüìù *Observa√ß√µes:* ${observacoesPedido}\n`;
            }

            // Enviar via WhatsApp
            const whatsappEmpresa = dadosConfig.contato?.whatsapp || '';
            const whatsappUrl = `https://wa.me/${whatsappEmpresa.replace(/\D/g, '')}?text=${encodeURIComponent(mensagem)}`;
            
            window.open(whatsappUrl, '_blank');
            
            // Limpar carrinho e fechar modal
            carrinho = [];
            atualizarCarrinho();
            fecharModal('modal-checkout-2');
            
            alert('Pedido enviado com sucesso! Voc√™ ser√° redirecionado para o WhatsApp.');
        }

        async function salvarCliente(nome, whatsapp) {
            // Simula√ß√£o de salvamento na planilha
            // Em uma implementa√ß√£o real, seria necess√°rio usar Google Apps Script
            console.log('Cliente salvo:', { nome, whatsapp });
        }

        async function buscarCEP() {
            const cep = document.getElementById('cep').value.replace(/\D/g, '');
            if (cep.length !== 8) return;

            try {
                const response = await fetch(`https://viacep.com.br/ws/${cep}/json/`);
                const data = await response.json();
                
                if (!data.erro) {
                    document.getElementById('endereco').value = data.logradouro;
                    document.getElementById('bairro').value = data.bairro;
                    document.getElementById('cidade').value = `${data.localidade} - ${data.uf}`;
                }
            } catch (error) {
                console.error('Erro ao buscar CEP:', error);
            }
        }

        function fecharModal(modalId) {
            document.getElementById(modalId).classList.remove('active');
        }

        function configurarBusca() {
            const inputBusca = document.getElementById('busca-produto');
            inputBusca.addEventListener('input', function(e) {
                const termo = e.target.value.toLowerCase();
                filtrarProdutos(termo);
            });
        }

        function filtrarProdutos(termo = '') {
            const produtosFiltrados = produtos.filter(produto => {
                const matchTermo = !termo || 
                    produto.item.toLowerCase().includes(termo) ||
                    produto.descricao.toLowerCase().includes(termo) ||
                    produto.categoria.toLowerCase().includes(termo);

                const matchFiltro = filtroAtivo === 'todos' || 
                    (produto.classificacao_adicional && produto.classificacao_adicional.toLowerCase().includes(filtroAtivo));

                return matchTermo && matchFiltro;
            });

            renderizarProdutosFiltrados(produtosFiltrados);
        }

        function aplicarFiltro(filtro) {
            filtroAtivo = filtro;
            
            // Atualizar bot√µes
            document.querySelectorAll('[id^="filtro-"]').forEach(btn => {
                btn.className = 'px-4 py-2 text-sm bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300';
            });
            document.getElementById(`filtro-${filtro}`).className = 'px-4 py-2 text-sm bg-primary text-white rounded-lg';
            
            // Aplicar filtro
            const termo = document.getElementById('busca-produto').value.toLowerCase();
            filtrarProdutos(termo);
        }

        function renderizarProdutosFiltrados(produtosFiltrados) {
            const container = document.getElementById('produtos-container');
            container.innerHTML = '';

            if (produtosFiltrados.length === 0) {
                container.innerHTML = '<div class="text-center py-12"><p class="text-gray-500 text-lg">Nenhum produto encontrado</p></div>';
                return;
            }

            // Agrupar por categoria
            const produtosPorCategoria = {};
            produtosFiltrados.forEach(produto => {
                if (!produtosPorCategoria[produto.categoria]) {
                    produtosPorCategoria[produto.categoria] = [];
                }
                produtosPorCategoria[produto.categoria].push(produto);
            });

            // Renderizar por categoria
            categorias.forEach(categoria => {
                const produtosCategoria = produtosPorCategoria[categoria.nome_categoria];
                
                if (produtosCategoria && produtosCategoria.length > 0) {
                    const section = document.createElement('section');
                    section.id = `categoria-${categoria.nome_categoria}`;
                    section.className = 'mb-8';

                    const titulo = document.createElement('h2');
                    titulo.className = 'text-2xl font-bold text-gray-800 mb-6';
                    titulo.textContent = categoria.titulo_exibicao || categoria.nome_categoria;
                    section.appendChild(titulo);

                    const grid = document.createElement('div');
                    grid.className = 'grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6';

                    produtosCategoria.forEach(produto => {
                        const card = criarCardProduto(produto);
                        grid.appendChild(card);
                    });

                    section.appendChild(grid);
                    container.appendChild(section);
                }
            });
        }

        function verificarHorarioFuncionamento() {
            const agora = new Date();
            const diaSemana = agora.getDay(); // 0 = domingo, 1 = segunda, etc.
            const horaAtual = agora.getHours() * 100 + agora.getMinutes(); // formato HHMM
            
            const diasSemana = ['domingo', 'segunda', 'terca', 'quarta', 'quinta', 'sexta', 'sabado'];
            const diaHoje = diasSemana[diaSemana];
            
            const horarioHoje = horarios.find(h => h.dia_semana === diaHoje);
            
            const statusElement = document.getElementById('status-loja');
            
            if (!horarioHoje || horarioHoje.status === 'fechado') {
                // Fechado
                statusElement.innerHTML = `
                    <div class="w-3 h-3 bg-red-500 rounded-full"></div>
                    <span class="text-sm font-medium text-red-600">Fechado</span>
                `;
                return;
            }
            
            const abertura = parseInt(horarioHoje.abertura.replace(':', ''));
            const fechamento = parseInt(horarioHoje.fechamento.replace(':', ''));
            
            if (horaAtual >= abertura && horaAtual <= fechamento) {
                // Aberto
                statusElement.innerHTML = `
                    <div class="w-3 h-3 bg-green-500 rounded-full animate-pulse"></div>
                    <span class="text-sm font-medium text-green-600">Aberto at√© ${horarioHoje.fechamento}</span>
                `;
            } else {
                // Fechado
                statusElement.innerHTML = `
                    <div class="w-3 h-3 bg-red-500 rounded-full"></div>
                    <span class="text-sm font-medium text-red-600">Fechado - Abre √†s ${horarioHoje.abertura}</span>
                `;
            }
        }

        // Event listeners
        document.addEventListener('change', function(e) {
            if (e.target.name === 'tipo-recebimento') {
                const enderecoSection = document.getElementById('endereco-section');
                const taxaDeliveryLine = document.getElementById('taxa-delivery-line');
                
                if (e.target.value === 'delivery') {
                    enderecoSection.classList.remove('hidden');
                    if (dadosConfig.checkout?.step2_taxa_delivery) {
                        const taxa = parseFloat(dadosConfig.checkout.step2_taxa_delivery);
                        document.getElementById('taxa-delivery').textContent = taxa.toFixed(2).replace('.', ',');
                        taxaDeliveryLine.classList.remove('hidden');
                        
                        const subtotal = carrinho.reduce((sum, item) => sum + item.total, 0);
                        const total = subtotal + taxa;
                        document.getElementById('total-checkout').textContent = total.toFixed(2).replace('.', ',');
                    }
                } else {
                    enderecoSection.classList.add('hidden');
                    taxaDeliveryLine.classList.add('hidden');
                    
                    const subtotal = carrinho.reduce((sum, item) => sum + item.total, 0);
                    document.getElementById('total-checkout').textContent = subtotal.toFixed(2).replace('.', ',');
                }
            }
        });

        // Fechar modais ao clicar fora
        document.addEventListener('click', function(e) {
            if (e.target.classList.contains('modal')) {
                e.target.classList.remove('active');
            }
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'964b2b1a5248ff2c',t:'MTc1MzQ0MTM4MS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
